# 按顺序执行脚本
./cleanup_docker.sh # 清理docker（docker相关配置和数据库表改变了需执行）
./install_dependencies.sh # 下载安装相关依赖
./configure_env.sh # 获得IP，配置相关配置（修改复制配置模板）
./setup_docker.sh # 启动docker，及相关服务
./setup_minio_buckets.sh # 配置minio及添加初始资源（只需在基础设施所在的机器上运行）

# 停止本地 PostgreSQL
sudo systemctl stop postgresql
sudo systemctl disable postgresql

# 停止本地 Redis
sudo systemctl stop redis
sudo systemctl stop redis-server
sudo systemctl disable redis
sudo systemctl disable redis-server

# 强制删除创建失败的 lepai 开头的容器
sudo docker rm -f lepai_pg lepai_redis lepai_minio

# 删除配置文件
sudo rm /etc/docker/daemon.json

# 手动更新配置文件
sudo tee /etc/docker/daemon.json <<EOF
{
  "registry-mirrors": [
    "https://docker.m.daocloud.io",
    "https://huecker.io",
    "https://dockerhub.timeweb.cloud",
    "https://noohub.ru",
    "https://hub-mirror.c.163.com",
    "https://mirror.baidubce.com"
  ]
}
EOF

# 重启 Docker
sudo systemctl daemon-reload
sudo systemctl restart docker

sudo rm /var/lib/pacman/db.lck
